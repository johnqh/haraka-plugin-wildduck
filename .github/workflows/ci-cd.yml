---
# CI/CD workflow for haraka-plugin-wildduck
# Automatically publishes to NPM and Docker Hub based on configured secrets

name: CI/CD

on:
    push:
        branches:
            - master
    pull_request:
        branches:
            - master

permissions:
    contents: write # For creating GitHub releases
    id-token: write # For NPM provenance
    deployments: write # For deployment tracking

jobs:
    cicd:
        uses: johnqh/workflows/.github/workflows/unified-cicd.yml@main
        with:
            docker-image-name: 'haraka'
            npm-access: 'public'
        secrets:
            NPM_TOKEN: ${{ secrets.NPM_TOKEN }}
            DOCKERHUB_USERNAME: ${{ secrets.DOCKERHUB_USERNAME }}
            DOCKERHUB_TOKEN: ${{ secrets.DOCKERHUB_TOKEN }}
